import{P as n,r as s,A as Y,u as Z,h as E,a as h,j as e,L as H,E as W,C as le,R as Q,I as de,b as ue,v as te,c as se,d as pe,M as fe,B as K,e as xe,S as ge}from"./index-meQg8-o7.js";const re=({setDeviceManagingFormOpen:o,selectedDevice:r,deviceCardReload:d,groupCardReload:c})=>{const[l,p]=s.useState(!1),[j,w]=s.useState(!1),[A,I]=s.useState(!1),[M,v]=s.useState(!1),[S,k]=s.useState(""),[f,x]=s.useState({}),[b,m]=s.useState(!1),[u,T]=s.useState(""),y=s.useContext(Y),{sendRequest:D}=Z(),O=s.useCallback(async()=>{v(!0);try{const i=await D({url:"/api/user/getUserInfo",method:"GET",headers:{Authorization:`Bearer ${y.token}`}});x(i.userInfo)}catch(i){E(i,k,p)}finally{v(!1)}},[y.token,D]),g=s.useCallback(async(i,q)=>{if(!r)return;const{deviceGroup:U,macAddress:L,deviceName:R,deviceType:C,battery:z}=r;console.log(` actionType  :: ${i}`),console.log(` inputValue  :: ${q}`),v(!0);try{let N,G,$;switch(i){case"deviceGroupUpdate":{N=`/api/device/${y.dbObjectId}/deviceGroupUpdate`,G={macAddress:L,deviceGroup:q},$="PATCH";break}case"deviceUpdate":{N=`/api/device/${y.dbObjectId}/deviceUpdate`,G={macAddress:L,deviceName:q},$="PATCH";break}case"deviceDelete":{N=`/api/device/${y.dbObjectId}/deviceDelete`,G={macAddress:L,deviceType:C},$="DELETE",h.reqDisconnect(L,C),h.reqRemoveParing(L,C);break}default:throw new Error(`Unexpected ActionType: ${i}`)}const _=await D({url:N,method:$,data:G,headers:{Authorization:`Bearer ${y.token}`}});o(!1)}catch(N){E(N,k,p)}finally{v(!1),await d()}},[y,D]);return s.useEffect(()=>{O()},[O]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10 w-full h-full bg-black bg-opacity-30",onClick:i=>{o(!1),i.stopPropagation()}}),M&&e.jsx(H,{}),e.jsx(W,{isOpen:l,onClose:()=>p(!1),content:S}),e.jsx(le,{isOpen:j,onClose:()=>w(!1),onConfirm:()=>{g("deviceDelete",""),w(!1)},title:"작업 확인",content:"정말 이 작업을 진행하시겠습니까?"}),f.deviceGroupList&&e.jsx(Q,{isOpen:b,onClose:()=>m(!1),onConfirm:()=>g("deviceGroupUpdate",u),title:"Group 변경",contents:f.deviceGroupList,setSelectedContent:i=>T(i)}),e.jsx(de,{isOpen:A,onConfirm:i=>g("deviceUpdate",i),setClose:()=>I(!1),title:"이름 변경",content:`현재 기기 명 : ${r.deviceName}`,inputTextType:"updateDeviceInfo",placeHolder:"변경할 기기 명",hintList:[],setPasswordCheck:!1}),e.jsxs("div",{className:"fixed z-40 inline-block w-10/12 max-w-lg p-2 mx-auto overflow-y-auto transform -translate-x-1/2 -translate-y-1/2 bg-orange-100 rounded-md shadow-xl max-h-96 top-1/3 left-1/2 ",onClick:i=>i.stopPropagation(),children:[e.jsx(ue,{onClose:()=>o(!1)}),e.jsxs("div",{className:"flex flex-col py-1",children:[e.jsx("h2",{className:"px-2 mb-4 text-lg font-bold text-center text-black",children:"- 기기 관리 -"}),e.jsxs("div",{className:"flex items-center p-1 mb-4 bg-white border border-gray-800",children:[e.jsx("span",{className:"flex-wrap text-sm text-black",children:r.deviceGroup}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{className:"text-black bg-orange-300 hover:bg-orange-400",onClick:()=>m(!0),children:"해당 기기 Group 변경"})})]}),e.jsxs("div",{className:"flex items-center p-1 mb-2 bg-white border border-gray-800",children:[e.jsx("span",{className:"flex-wrap text-sm text-black",children:r.deviceName}),e.jsxs("div",{className:"ml-auto",children:[e.jsx("button",{className:"text-black bg-orange-300 text- hover:bg-orange-400",onClick:()=>{I(!0)},children:"이름 변경"}),e.jsx("button",{className:"text-black bg-orange-300 hover:bg-orange-400",onClick:()=>{w(!0)},children:"삭제"})]})]}),e.jsx("div",{className:"flex items-center p-1 mb-1 bg-white border border-gray-800",children:e.jsx("span",{className:"flex-wrap text-sm text-black",children:`battery : ${r.battery}`})})]}),e.jsx("div",{className:"flex items-center p-1 mb-2 bg-white border border-gray-800",children:e.jsx("span",{className:"flex-wrap text-sm text-black",children:`deviceType : ${r.deviceType}`})}),e.jsx("div",{className:"flex items-center p-1 mb-2 bg-white border border-gray-800",children:e.jsx("span",{className:"flex-wrap text-sm text-black",children:`macAddress : ${r.macAddress}`})}),e.jsx("div",{className:"sticky bottom-0 text-lg font-bold text-center text-gray-500 transform -translate-x-1/2 left-1/2 animate-bounce",children:"↓"})]})]})};re.propTypes={setDeviceManagingFormOpen:n.func.isRequired,selectedDevice:n.shape({deviceGroup:n.string.isRequired,macAddress:n.string.isRequired,deviceName:n.string.isRequired,deviceType:n.string.isRequired,battery:n.string}).isRequired,deviceCardReload:n.func.isRequired,groupCardReload:n.func.isRequired};const ne=({w:o="24",h:r="24",c:d="none"})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:o,height:r,viewBox:"0 0 100 100",fill:d,stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M15 5c-5.4881077 0-10 4.51189-10 10v70c0 5.4881 4.5118923 10 10 10h70c5.488108 0 10-4.5119 10-10v-25a3.0003 3.0003 0 1 0 -6 0v25c0 2.2679-1.73211 4-4 4h-70c-2.26789 0-4-1.7321-4-4v-70c0-2.26789 1.73211-4 4-4h70c2.26789 0 4 1.73211 4 4v35a3.0003 3.0003 0 1 0 6 0v-35c0-5.48811-4.511892-10-10-10zm34.96875 11.9375a3.0003 3.0003 0 0 0 -2.96875 3.0625v26a3.0003 3.0003 0 1 0 6 0v-26a3.0003 3.0003 0 0 0 -3.03125-3.0625zm-10.1875 10.03125a3.0003 3.0003 0 0 0 -1.0625.3125c-9.788871 4.59113-16.71875 14.91918-16.71875 26.71875 0 15.9727 12.51553 29 28 29 15.484471 0 28-13.0273 28-29 0-11.79957-6.929879-22.12762-16.71875-26.71875a3.0055288 3.0055288 0 1 0 -2.5625 5.4375c7.623315 3.57545 13.28125 11.8537 13.28125 21.28125 0 12.8679-9.870233 23-22 23-12.129766 0-22-10.1321-22-23 0-9.42755 5.657935-17.7058 13.28125-21.28125a3.0003 3.0003 0 0 0 -1.5-5.75z"})});ne.propTypes={w:n.string,h:n.string,c:n.string};const P=({vx:o=0,vy:r=-25,vw:d=130,vh:c=130,c:l="none"})=>e.jsx("div",{style:{color:"white",width:"40px",height:"40px"},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",viewBox:`${o} ${r} ${d} ${c}`,xmlSpace:"preserve",fill:"currentColor",children:[e.jsx("circle",{cx:"50",cy:"50",r:"48",stroke:"currentColor",strokeWidth:"5",fill:"none"}),e.jsx("path",{d:"M66.4,63.6L52.8,50l13.6-13.6c0.8-0.8,0.8-2,0-2.8l-15-15c-0.6-0.6-1.4-0.7-2.2-0.4c-0.7,0.3-1.2,1-1.2,1.8v25.2L36.4,33.6  c-0.8-0.8-2-0.8-2.8,0c-0.8,0.8-0.8,2,0,2.8L47.2,50L33.6,63.6c-0.8,0.8-0.8,2,0,2.8c0.8,0.8,2,0.8,2.8,0L48,54.8V80  c0,0.8,0.5,1.5,1.2,1.8C49.5,82,49.7,82,50,82c0.5,0,1-0.2,1.4-0.6l15-15C67.2,65.6,67.2,64.4,66.4,63.6z M52,24.8L62.2,35L52,45.2  V24.8z M52,75.2V54.8L62.2,65L52,75.2z"}),e.jsx("g",{transform:"translate(85, 10)",children:e.jsx("circle",{cx:"0",cy:"0",r:"20",fill:l})})]})});P.propTypes={vw:n.number,vh:n.number,c:n.string};function ve(o,r){var l,p;let d="yellow";const c=(p=(l=o.find(j=>j.deviceInfo.macAddress===r))==null?void 0:l.msg)==null?void 0:p.readData.status;return c=="1"?d="green":c=="0"&&(d="red"),e.jsx(ne,{w:"60",h:"40",c:d})}function me(o,r,d){let c="white";r.length===0&&(c="yellow");for(let p of r)if(p.deviceInfo.macAddress===d){c="green";break}else c="red";var l="";switch(o){case"안방불11":l=P;break;case"안방불2":l=P;break;case"test2":l=P;break;case"ccb_v1":l=P;break;default:l=P;break}return e.jsx(l,{vx:0,vy:-25,vw:130,vh:130,c})}const oe=({deviceInfo:o,deviceCardReload:r,groupCardReload:d,deviceStatusList:c})=>{var D,O;const[l,p]=s.useState(!1),[j,w]=s.useState(!1),[A,I]=s.useState(""),[M,v]=s.useState(!1),[S,k]=s.useState(!1),{deviceGroup:f,macAddress:x,deviceName:b,deviceType:m}=o;let{battery:u}=o;const T=async()=>{try{await y(S,o),k(g=>!g)}catch(g){console.error("API 호출 중 오류 발생:",g)}},y=async(g,i)=>{if(!i)return;const{deviceGroup:q,macAddress:U,deviceName:L,deviceType:R,battery:C}=i;g?(console.log("비활성화 API 호출"),h.pubSendData(U,R,{toggleSwitch:"0"})):(console.log("활성화 API 호출"),h.pubSendData(U,R,{toggleSwitch:"1"}))};return e.jsxs(e.Fragment,{children:[l&&e.jsx(H,{}),e.jsx(W,{isOpen:j,onClose:()=>w(!1),content:A}),e.jsxs("div",{style:{border:"1px solid #ccc",borderRadius:"10px",padding:"2px",position:"relative",cursor:"pointer",width:"100%",maxWidth:"300px",display:"flex",justifyContent:"space-between",boxSizing:"border-box"},onClick:()=>v(!0),className:"flex flex-col",children:[M&&e.jsx(re,{setDeviceManagingFormOpen:v,selectedDevice:o,deviceCardReload:r,groupCardReload:d}),e.jsx("p",{className:"mt-0 mb-1 ml-2 text-left text-gray-100",children:b}),e.jsxs("div",{className:"flex items-center justify-between mt-0 mb-2 ml-2 mr-1",children:[me(m,c,x),e.jsx("button",{onClick:g=>{g.stopPropagation(),T()},className:"items-end px-0 py-0 bg-gray-600 border rounded",children:ve(c,x)})]}),e.jsx("span",{className:"absolute inset-x-0 bottom-0 h-1 w-full",style:{width:`${u=((O=(D=c.find(g=>g.deviceInfo.macAddress===o.macAddress))==null?void 0:D.msg)==null?void 0:O.readData.battery)||u}%`,backgroundColor:u>75?"green":u>50?"yellow":u>25?"orange":"red",transition:"width 0.3s ease-in-out"}})]})]})};oe.propTypes={deviceInfo:n.shape({deviceGroup:n.string.isRequired,macAddress:n.string.isRequired,deviceName:n.string.isRequired,deviceType:n.string.isRequired,battery:n.string}).isRequired,deviceCardReload:n.func.isRequired,groupCardReload:n.func.isRequired,deviceStatusList:n.array.isRequired};const ae=({userGroupList:o,groupCardReload:r,deviceStatusList:d})=>{const[c,l]=s.useState(!1),[p,j]=s.useState(!1),[w,A]=s.useState(""),[I,M]=s.useState({}),{sendRequest:v}=Z(),S=s.useContext(Y),k=s.useCallback(async()=>{l(!0);try{const x=(await v({url:`/api/device/${S.dbObjectId}/deviceList`,method:"GET",headers:{Authorization:`Bearer ${S.token}`}})).deviceList;let b={};for(let m of o)for(let u of x)b[m]||(b[m]=[]),m===u.device_group&&b[m].push({deviceGroup:u.device_group||"N/A",macAddress:u.mac_address||"",deviceName:u.device_name||"Unknown Device",deviceType:u.device_type||"Unknown Device",battery:u.battery||"N/A"});M(b)}catch(f){E(f,A,j)}finally{l(!1)}},[S.dbObjectId,S.token,v,o]);return s.useEffect(()=>{k()},[o,k]),e.jsxs("div",{className:"max-w-full rounded-lg shadow-md",children:[c&&e.jsx(H,{}),e.jsx(W,{isOpen:p,onClose:()=>j(!1),content:w}),o.map(f=>e.jsxs("div",{className:"relative ml-2 mr-2 bg-transparent rounded",children:[e.jsx("h2",{className:"absolute ml-2 text-lg font-bold text-white",children:f}),e.jsx("div",{className:"grid grid-cols-2 gap-2 px-1 py-7",children:(I[f]||[]).map((x,b)=>e.jsx(oe,{deviceInfo:{deviceGroup:x.deviceGroup,macAddress:x.macAddress,deviceName:x.deviceName,deviceType:x.deviceType,battery:x.battery},deviceCardReload:k,groupCardReload:r,deviceStatusList:d},x.id||b))})]},f))]})};ae.propTypes={userGroupList:n.array.isRequired,groupCardReload:n.func.isRequired,deviceStatusList:n.array.isRequired};const he=()=>e.jsx("div",{style:{color:"white",width:"24px",height:"24px"},children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",x:"0px",y:"0px",viewBox:"0 0 100 100",style:{enableBackground:"new 0 0 100 100"},xmlSpace:"preserve",fill:"currentColor",children:[e.jsx("circle",{cx:"50",cy:"50",r:"48",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{d:"M66.4,63.6L52.8,50l13.6-13.6c0.8-0.8,0.8-2,0-2.8l-15-15c-0.6-0.6-1.4-0.7-2.2-0.4c-0.7,0.3-1.2,1-1.2,1.8v25.2L36.4,33.6  c-0.8-0.8-2-0.8-2.8,0c-0.8,0.8-0.8,2,0,2.8L47.2,50L33.6,63.6c-0.8,0.8-0.8,2,0,2.8c0.8,0.8,2,0.8,2.8,0L48,54.8V80  c0,0.8,0.5,1.5,1.2,1.8C49.5,82,49.7,82,50,82c0.5,0,1-0.2,1.4-0.6l15-15C67.2,65.6,67.2,64.4,66.4,63.6z M52,24.8L62.2,35L52,45.2  V24.8z M52,75.2V54.8L62.2,65L52,75.2z"}),e.jsxs("g",{transform:"translate(70, 20)",children:[e.jsx("circle",{cx:"9",cy:"-3",r:"18",fill:"white"}),e.jsx("text",{x:"10",y:"12",fill:"black",fontSize:"50",textAnchor:"middle",children:"+"})]})]})});function ye(){const[o,r]=s.useState(!1),[d,c]=s.useState(!1),[l,p]=s.useState(""),[j,w]=s.useState(!1),[A,I]=s.useState(""),[M,v]=s.useState(!1),[S,k]=s.useState(""),[f,x]=s.useState([]),[b,m]=s.useState(!1),[u,T]=s.useState([]),[y,D]=s.useState([]),[O,g]=s.useState([]),[i,q]=s.useState([]),[U,L]=s.useState(!1);s.useEffect(()=>{console.log(`connectedDeviceList 상태 변경 : ${JSON.stringify(O,null,2)}`)},[O]),s.useEffect(()=>{console.log(`deviceStatusList 상태 변경 : ${JSON.stringify(i,null,2)}`)},[i]),s.useEffect(()=>{console.log(`deviceScanList 상태 변경 : ${JSON.stringify(f,null,2)}`)},[f]);const{sendRequest:R}=Z(),C=s.useContext(Y),z=s.useCallback(async()=>{r(!0);try{const t=await R({url:"/api/user/getUserInfo",method:"GET",headers:{Authorization:`Bearer ${C.token}`}});T(t.userInfo.deviceGroupList),D(t.userInfo.deviceGroupList)}catch(t){E(t,p,c)}finally{r(!1)}},[C.token,R]),N=s.useCallback(async(t,a,B,V)=>{try{console.log("createDevice ",t,a,B,V),r(!0),await R({url:`/api/device/${C.dbObjectId}/deviceCreate`,method:"POST",headers:{Authorization:`Bearer ${C.token}`},data:{deviceGroup:V,macAddress:t,deviceType:a,battery:B}})}catch(X){E(X,p,c),h.reqDisconnect(t,a),h.reqRemoveParing(t,a),console.log("디바이스 추가 실패 : 자동 Disconnect 및 Paring 삭제")}finally{r(!1),console.log("createDevice END")}},[C.dbObjectId,C.token,R]),G=s.useCallback(async t=>{try{return console.log("resScanStart 받은 DATA : ",JSON.stringify(t,null,2)),te(t).isValid?(x(t.deviceList),!0):!1}catch(a){return console.error(`에러 발생 1: ${a.message}`),!1}},[]),$=s.useCallback(async t=>{try{if(console.log(`resConnect : ${JSON.stringify(t,null,2)}`),!se(t).isValid)throw{status:133};return await N(t.macAddress,t.deviceType,"50",A),!0}catch(a){E(a,p,c)}finally{r(!1),w(!1),await z(),console.log("resConnect END")}},[N,z,A]),_=s.useCallback(async t=>{try{if(!te(t).isValid||t.deviceList.length===0)return g([]),console.log("유효하지 않거나 빈 리스트입니다. 상태를 유지합니다."),!1;g(t.deviceList);for(let a of t.deviceList)h.reqReadData(a.macAddress,a.deviceType);return!0}catch(a){return console.error(`에러 발생 1: ${a.message}`),!1}},[]),ce=s.useCallback(async t=>{try{if(console.log(`resAutoConnect 받은 DATA : ${Object.prototype.toString.call(t)} :${JSON.stringify(t,null,2)}`),!se(t).isValid)throw{status:133};return!0}catch(a){E(a,p,c)}finally{r(!1)}},[]),ee=s.useCallback(async t=>{try{if(!pe(t).isValid)throw{status:133};return q(B=>{const V=B.findIndex(J=>J.deviceInfo.macAddress===t.deviceInfo.macAddress),X=t.msg.readData.replace(/'/g,'"');return t.msg.readData=JSON.parse(X),V===-1?[...B,t]:B.map((J,ie)=>ie===V?{...J,msg:t.msg}:J)}),console.log(`resReadData : ${JSON.stringify(t,null,2)}`),!0}catch(a){return console.error(`에러 발생 1: ${a.message}`),!1}},[]),F=s.useCallback(()=>{try{return h.reqScanStop(),x([]),!0}catch(t){return console.error(`에러 발생 1: ${t.message}`),!1}},[]);return s.useEffect(()=>{async function t(){await z()}t()},[z]),s.useEffect(()=>(window.resConnect=$,window.resConnectedDevices=_,window.resAutoConnect=()=>h.reqConnectedDevices(),window.resReadData=ee,window.resScanStart=G,window.resScanStop=h.resScanStop,L(!0),()=>{delete window.resConnect,delete window.resConnectedDevices,delete window.resAutoConnect,delete window.resReadData,L(!1)}),[$,_,ce,ee,G]),s.useEffect(()=>{},[U]),e.jsxs(e.Fragment,{children:[o&&e.jsx(H,{}),e.jsx(W,{isOpen:d,onClose:()=>c(!1),content:l}),e.jsx(Q,{isOpen:j,onClose:()=>{w(!1),F()},onConfirm:()=>{v(!0),h.reqScanStart()},title:"Group 선택",contents:y,setSelectedContent:t=>{I(t),console.log(`선택된 그룹 : ${t}`)},confirmButtonContent:"선택"}),e.jsx(Q,{isOpen:M,onClose:()=>{v(!1),F()},onConfirm:()=>{const t=f.find(a=>a.deviceType==S);h.reqConnect(t.macAddress,t.deviceType),F(),v(!1)},title:"기기 선택",contents:f.map(t=>t.deviceType),setSelectedContent:t=>{k(t),console.log(`선택된 기기 : ${t}`),console.log(JSON.stringify(f.find(a=>a.deviceType==t),null,2))},confirmButtonContent:"추가"}),e.jsx(fe,{isOpen:b,onClose:()=>m(!1),onConfirm:t=>{t.length>0&&T(t),m(!1)},title:"필터링 그룹 선택",contents:y,confirmButtonContent:"완료"}),e.jsxs("div",{className:"flex flex-row-reverse justify-between gap-1 mt-1 mb-4 ml-2 mr-2",children:[e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx(K,{icon:xe,onClick:()=>m(!0)}),e.jsx(K,{icon:he,onClick:()=>w(!0)})]}),e.jsx(K,{icon:ge,content:"기기 상태 동기화",onClick:()=>{console.log("화면 갱신 버튼 호출"),h.reqConnectedDevices()}})]}),e.jsx("div",{className:"flex flex-col",children:u.length>0&&e.jsx(ae,{userGroupList:u,groupCardReload:z,deviceStatusList:i})})]})}export{ye as default};
