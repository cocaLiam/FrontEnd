import{P as T,r as a,u as D,A as P,h as C,j as e,L as q,E as A,I as H,B as I}from"./index-meQg8-o7.js";const _=({isOpen:r,onClose:p})=>{const[n,m]=a.useState(!1),[E,i]=a.useState(!1),[k,g]=a.useState(""),{sendRequest:w}=D(),y=a.useContext(P),l=a.useCallback(async c=>{const d=c.credential;m(!0);try{const h=await w({url:"/api/oauth/googleLogin",method:"POST",data:{credential:d}});console.log("로그인 성공:",h);const{dbObjectId:S,token:f}=h;await y.saveToken(S,f),p()}catch(h){console.error("로그인 실패:",h),C(h,g,i)}finally{m(!1)}},[w,p]);return a.useEffect(()=>{window.handleCredentialResponse=l;const c=document.createElement("script");return c.src="https://accounts.google.com/gsi/client",c.async=!0,document.head.appendChild(c),()=>{delete window.handleCredentialResponse,c.parentNode&&c.parentNode.removeChild(c)}},[l]),r?e.jsxs(e.Fragment,{children:[n&&e.jsx(q,{}),e.jsx(A,{isOpen:E,onClose:()=>i(!1),content:k}),e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black opacity-50",onClick:p}),e.jsxs("div",{className:"z-10 p-8 bg-white rounded-lg shadow-xl",children:[e.jsx("h2",{className:"mb-4 text-2xl font-bold",children:"구글 로그인"}),e.jsx("div",{id:"g_id_onload","data-client_id":"981815966093-0qc1dhhan67old40mgquj6dkgqoev280.apps.googleusercontent.com","data-callback":"handleCredentialResponse","data-auto_prompt":"false"}),e.jsx("div",{className:"g_id_signin","data-type":"standard","data-size":"large","data-theme":"outline","data-text":"sign_in_with","data-shape":"rectangular","data-logo_alignment":"left"}),e.jsx("button",{onClick:p,className:"w-full px-4 py-2 mt-4 text-gray-700 transition-colors bg-gray-200 rounded hover:bg-gray-300",children:"닫기"})]})]})]}):null};_.propTypes={isOpen:T.bool.isRequired,onClose:T.func.isRequired};const J=()=>{const[r,p]=a.useState({userEmail:"",password:""}),[n,m]=a.useState(!1),[E,i]=a.useState(!1),[k,g]=a.useState(""),w=a.useContext(P),[y,l]=a.useState(!1),[c,d]=a.useState(!1),{sendRequest:h}=D(),S=a.useCallback(async u=>{m(!0);try{const b=await h({url:"/api/oauth/passwordReset",method:"POST",data:{userEmail:u}});console.log(`responseData : ${JSON.stringify(b,null,2)}`)}catch(b){C(b,g,i)}finally{m(!1)}},[h]),f=u=>{const{name:b,value:N}=u.target;p(M=>({...M,[b]:N}))},x=async u=>{u.preventDefault(),m(!0);try{await w.login(r.userEmail,r.password)}catch(b){C(b,g,i)}finally{m(!1)}},R=u=>{console.log("Input 입력값 : ",u),S(u),l(!1)};return e.jsxs(e.Fragment,{children:[n&&e.jsx(q,{}),e.jsx(A,{isOpen:E,onClose:()=>i(!1),content:k}),e.jsx(H,{isOpen:y,onConfirm:R,setClose:()=>l(!1),title:"비밀번호 찾기",content:"가입하신 이메일 주소를 입력해 주세요. 임시 비밀번호를 이메일로 발송해 드립니다.",inputTextType:"userEmail",placeHolder:"help@cocabot.com",setPasswordCheck:!1}),e.jsx(_,{isOpen:c,onClose:()=>d(!1)}),e.jsxs("form",{onSubmit:x,className:"w-full space-y-2",children:[e.jsx("div",{children:e.jsx("input",{className:"w-full p-2 text-white bg-gray-800 rounded",name:"userEmail",type:"email",value:r.userEmail,onChange:f,placeholder:"이메일",required:!0})}),e.jsx("div",{children:e.jsx("input",{className:"w-full p-2 text-white bg-gray-800 rounded",type:"password",name:"password",value:r.password,onChange:f,placeholder:"비밀번호",required:!0})}),e.jsx("button",{type:"submit",disabled:n,className:"w-full p-1 text-white bg-blue-600 rounded hover:bg-blue-500 disabled:bg-blue-300",children:"로그인"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(I,{content:"Google",classStyle:"justify-center",onClick:()=>{console.log("Google"),d(!0)}}),e.jsx(I,{content:"Naver",classStyle:"justify-center",onClick:()=>console.log("Naver")}),e.jsx(I,{content:"kakao",classStyle:"justify-center",onClick:()=>console.log("kakao")})]}),e.jsx("div",{className:"text-xs",children:e.jsxs("span",{children:[e.jsx("span",{className:"text-blue-500 cursor-pointer",onClick:()=>console.log("Email clicked"),children:"Email"})," ","찾기",e.jsx("br",{}),e.jsx("span",{className:"text-blue-500 cursor-pointer",onClick:()=>{console.log("Password clicked"),l(!0)},children:"Password"})," ","초기화"]})})]})]})},K=30,V=()=>{const[r,p]=a.useState({userName:"",userEmail:"",password:"",confirmPassword:"",homeAddress:"",phoneNumber:""}),[n,m]=a.useState({userName:"",userEmail:"",password:"",confirmPassword:"",homeAddress:"",phoneNumber:""}),[E,i]=a.useState(!1),[k,g]=a.useState(!1),[w,y]=a.useState(""),[l,c]=a.useState("전송"),[d,h]=a.useState(null),[S,f]=a.useState(!1),[x,R]=a.useState(["","","",""]),u=a.useRef([]),b=a.useContext(P),{sendRequest:N}=D(),M=(o,s)=>{let t="";switch(o){case"userName":s.trim()||(t="이름을 입력해주세요.");break;case"userEmail":{/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||(t="유효한 이메일 주소를 입력해주세요.");break}case"password":s.length<6&&(t="비밀번호는 최소 6자리 이상이어야 합니다.");break;case"confirmPassword":s!==r.password&&(t="비밀번호가 일치하지 않습니다.");break;case"homeAddress":s.trim()||(t="주소를 입력해주세요.");break;case"phoneNumber":{/^[0-9]{10,11}$/.test(s)||(t="유효한 전화번호를 입력해주세요.");break}}return t},v=o=>{const{name:s,value:t}=o.target;p(O=>({...O,[s]:t}));const j=M(s,t);m(O=>({...O,[s]:j}))},F=async o=>{o.preventDefault();const s={};if(Object.keys(r).forEach(t=>{const j=M(t,r[t]);j&&(s[t]=j)}),Object.keys(s).length>0){m(s),y("입력값을 확인해주세요."),g(!0);return}i(!0);try{const t=await b.signup(r.userName,r.userEmail,r.password,r.homeAddress,r.phoneNumber);console.log("Signup 성공 :",t)}catch(t){C(t,y,g)}finally{i(!1)}},L=a.useCallback(o=>{d&&(clearInterval(d),f(!1));const s=setInterval(()=>{o--;const t=Math.floor(o/60),j=o%60,O=`${t}분 ${j.toString().padStart(2,"0")}초`;o<=0?(clearInterval(s),f(!1),c("재전송")):c(O)},1e3);h(s)},[d]),$=a.useCallback(async o=>{i(!0);try{const s=await N({url:"/api/oauth/verifyEmail",method:"POST",data:{userEmail:o}});console.log(`responseData : ${JSON.stringify(s,null,2)}`),L(K),f(!0)}catch(s){C(s,y,g)}finally{i(!1)}},[N,L]),B=a.useCallback(async(o,s)=>{i(!0);try{const t=await N({url:"/api/oauth/checkEmail",method:"POST",data:{userEmail:o,pinCode:s}});console.log(`responseData : ${JSON.stringify(t,null,2)}`),console.log(t),clearInterval(d),f(!1),c("인증 성공")}catch(t){C(t,y,g)}finally{i(!1)}},[d,N]),z=a.useCallback((o,s)=>{if(s.length>1)return;const t=[...x];t[o]=s,R(t),s&&o<x.length-1&&u.current[o+1].focus()},[x]),G=a.useCallback((o,s)=>{s.key==="Backspace"&&!x[o]&&o>0&&u.current[o-1].focus()},[x]);return a.useEffect(()=>()=>{d&&clearInterval(d)},[d]),e.jsxs("form",{onSubmit:F,className:"mt-8 space-y-6",children:[E&&e.jsx(q,{}),e.jsx(A,{isOpen:k,onClose:()=>g(!1),content:w}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[e.jsx("input",{name:"userEmail",type:"email",value:r.userEmail,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"이메일",disabled:l!=="전송"&&l!=="재전송"}),r.userEmail!==""&&n.userEmail===""&&e.jsx(I,{content:l,onClick:()=>{(l==="전송"||l==="재전송")&&$(r.userEmail)}})]}),n.userEmail&&e.jsx("p",{className:"text-sm text-red-500",children:n.userEmail}),S&&e.jsxs("div",{className:"flex justify-center space-x-2",children:[x.map((o,s)=>e.jsx("input",{ref:t=>u.current[s]=t,type:"text",maxLength:"1",className:"w-10 h-10 text-xs font-bold text-center text-white bg-gray-800 border-2 border-gray-700 rounded-lg focus:border-blue-500 focus:outline-none",value:o,onChange:t=>z(s,t.target.value),onKeyDown:t=>G(s,t)},s)),e.jsx(I,{content:"전송",onClick:()=>B(r.userEmail,x.join(""))})]})]}),e.jsxs("div",{children:[e.jsx("input",{name:"password",type:"password",value:r.password,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"비밀번호"}),n.password&&e.jsx("p",{className:"text-sm text-red-500",children:n.password})]}),e.jsxs("div",{children:[e.jsx("input",{name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"비밀번호 확인"}),n.confirmPassword&&e.jsx("p",{className:"text-sm text-red-500",children:n.confirmPassword})]}),e.jsxs("div",{children:[e.jsx("input",{name:"userName",type:"text",value:r.userName,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"이름"}),n.userName&&e.jsx("p",{className:"text-sm text-red-500",children:n.userName})]}),e.jsxs("div",{children:[e.jsx("input",{name:"homeAddress",type:"text",value:r.homeAddress,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"주소"}),n.homeAddress&&e.jsx("p",{className:"text-sm text-red-500",children:n.homeAddress})]}),e.jsxs("div",{children:[e.jsx("input",{name:"phoneNumber",type:"tel",value:r.phoneNumber,onChange:v,required:!0,className:"relative block w-full px-3 py-2 text-white placeholder-gray-400 bg-gray-800 border border-gray-700 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"01012341234"}),n.phoneNumber&&e.jsx("p",{className:"text-sm text-red-500",children:n.phoneNumber})]})]}),e.jsx("button",{type:"submit",className:`w-full px-4 py-2 text-sm font-medium text-white border border-transparent rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
          ${l==="인증 성공"?"bg-blue-600 hover:bg-blue-700":"bg-gray-500 cursor-not-allowed"}`,disabled:l!=="인증 성공",children:"회원가입"})]})},X=()=>{const[r,p]=a.useState(!0),n=()=>{p(!r)};return e.jsxs("div",{className:"absolute inline-block p-6 space-y-2 overflow-y-auto transform -translate-x-1/2 -translate-y-1/2 bg-gray-900 rounded-lg shadow-lg max-h-96 top-1/3 left-1/2",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 space-y-2 bg-gray-900 rounded-lg shadow-lg w-[250px]",children:[e.jsx("div",{className:"text-center",children:e.jsx("h2",{className:"text-3xl font-bold text-white",children:r?"로그인":"회원가입"})}),r?e.jsx(J,{}):e.jsx(V,{}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:n,className:"text-sm text-blue-500 hover:text-blue-400",children:r?"회원가입하기":"로그인하기"})})]}),r||e.jsx("div",{className:"sticky bottom-0 text-lg font-bold text-center text-gray-100 transform -translate-x-1/2 left-1/2 animate-bounce",children:"↓"})]})};export{X as default};
